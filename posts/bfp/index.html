<!DOCTYPE html>
<html><head>
<title>Gregg - BFP Performance Tools</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://rsms.me" crossorigin>


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,700&family=JetBrains+Mono&display=swap">
<link rel="stylesheet" href="https://rsms.me/inter/inter.css">



<link rel="stylesheet" href="/css/main.min.7a8dc5b063775e5d3df0beea151395736f55ccb3343f70eea0595b53da5015c4.css">


<script defer src="/en.search.min.3ed001a2a483a534a654d44c5a2684e57e9ceb6ef670d19ea7a56a80bf0c284e.js" integrity="sha256-PtABoqSDpTSmVNRMWiaE5X6c6272cNGep6VqgL8MKE4="></script>


<link rel="stylesheet" href="/katex/katex.min.css" media="print" onload="this.media='all'">
<noscript><link rel="stylesheet" href="/katex/katex.min.css"></noscript>
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
</head>
<body><header>
    <div class="header-main">
        <a href="/" id="logo">
            <img src="/svg/icon.svg" alt="icon" id="raccoon" />
        </a>
        <h3 class="site-title">عجفت الغور</h3>
        <div id="search">
            
<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>

        </div>
    </div>
    <nav id="breadcrumb" aria-label="Note trail"><span class="trail-label">trail</span><span class="trail-crumbs"></span></nav>
</header>

<div class="layout-container">
  <div class="grid-container">
    <div class="grid">
      <div class="page" data-level="1">
        <div class="content">
            <h1>Gregg - BFP Performance Tools</h1>
            


            <p>Tags: <a href="/posts/computers/">computers</a>, <a href="/posts/20200414223410-books/">books</a>, <a href="/posts/bpf/">bpf</a></p>
<h2 id="chapter-1-intro">Chapter 1 - Intro</h2>
<ul>
<li>Turned into a general purpose execution engine in 2014</li>
<li>VM</li>
</ul>
<h3 id="tracing-snooping-sampling-profiling-and-observability">Tracing, Snooping, Sampling, Profiling, and Observability</h3>
<ul>
<li>Tracing: event based recording
<ul>
<li>Tracing and snooping are the same thing</li>
<li><code>strace</code>, <code>tcp-dump</code>, etc</li>
</ul>
</li>
<li>Sampling: tools that take subsets of a measurements to paint a coarse picture
<ul>
<li>Only rough picture</li>
</ul>
</li>
<li>Observability: understanding a system through observation
<ul>
<li>Includes tracing tools, sampling tools, and fixed counters</li>
<li>Does not include benchmark tools</li>
</ul>
</li>
</ul>
<h3 id="bcc-bfptrace-io-visor">BCC/BFPTrace/IO Visor</h3>
<h4 id="bcc-bfp-compiler-collection">BCC: BFP Compiler Collection</h4>
<ul>
<li>First high levle tracing framework developed for BPF
<ul>
<li>Provides C, with interfaces for Python, lua, and C++</li>
<li>Much more complex than bfptrace</li>
<li>Meant for complex tools</li>
</ul>
</li>
</ul>
<h4 id="bfptrace">bfptrace</h4>
<ul>
<li>Newer frontend, special purpose high level programming langauge</li>
<li>meant for one line scripts</li>
</ul>
<h4 id="io-visor">IO Visor</h4>
<ul>
<li>Linux foundation project on GH</li>
<li>Encompases both bcc and bpftrace</li>
</ul>
<h3 id="bcc">BCC</h3>
<h4 id="execsnoop--8"><code>execsnoop(8)</code></h4>
<ul>
<li>Traces <code>execve(2)</code> system call</li>
<li>Output reveals which processes were executed while tracing</li>
<li>this prints out per-event data, but other tools allow for summaries</li>
</ul>
<h4 id="biolatency--8"><code>biolatency(8)</code></h4>
<ul>
<li>Traces block io latency</li>
<li>Displays an ASCII histogram of sizes</li>
</ul>
<h3 id="visability">Visability</h3>
<ul>
<li>BPF tracing gives you visibility across the full software stack</li>
<li>Supports:
<ul>
<li>Applications tracing with runtimes</li>
<li>Application tracing with compiled code</li>
<li><code>/lib/*</code> information
<ul>
<li>same as <code>ltrace</code></li>
</ul>
</li>
<li><a href="/posts/syscalls/">syscalls</a> interface
<ul>
<li>same as <code>strace</code> or <code>perf</code></li>
<li><a href="/posts/linux/">linux</a> scheduler, file systems, TCP/IP, etc
<ul>
<li>same as <code>ftrace</code> or <code>perf</code></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/hardware/">hardware</a> tracing
<ul>
<li><code>perf</code>, <code>sar</code>, <code>/proc</code> counters</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dynamic-instrumentation-kprobes-and-uprobes">Dynamic instrumentation: kprobes and uprobes</h3>
<ul>
<li>Dynamic instrumentation allows for probing of live running software</li>
<li>Examples:
<table>
<thead>
<tr>
<th>Probe</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>kprobe:vfs_read</td>
<td>Beginning of vfs_read()</td>
</tr>
<tr>
<td>kretprobe:vfs_read</td>
<td>End of vfs_read()</td>
</tr>
<tr>
<td>uprobe:/bin/bash:readline</td>
<td>Beginning of readline() function in bash</td>
</tr>
<tr>
<td>uretprobe:/bin/bash:readline</td>
<td>End of readline() function in bas</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="static-instrumentation-tracepoints-and-usdt">Static instrumentation: tracepoints and usdt</h3>
<ul>
<li>Function names change and dynamic instrumentation may not always be correct</li>
<li>Can use tracepoints or user statically defined tracing:
<table>
<thead>
<tr>
<th>Probe</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>tracepoint:syscalls:sys_enter_open</td>
<td>instrument open(2) syscall</td>
</tr>
<tr>
<td>usdt:/usr/sbin/mysqld:mysql:query__start</td>
<td>query__start probe</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="bpftrace"><code>bpftrace</code></h3>
<ul>
<li>takes <code>-e</code> for execute</li>
<li><code>-l</code> for listing open tracepoints</li>
</ul>

            




   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   




        </div>
      </div>
    </div>
  </div>
  

<nav id="toc" class="toc-sidebar">
  <div class="toc-content">
    <h2>Table of Contents</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#chapter-1-intro">Chapter 1 - Intro</a>
      <ul>
        <li><a href="#tracing-snooping-sampling-profiling-and-observability">Tracing, Snooping, Sampling, Profiling, and Observability</a></li>
        <li><a href="#bcc-bfptrace-io-visor">BCC/BFPTrace/IO Visor</a></li>
        <li><a href="#bcc">BCC</a></li>
        <li><a href="#visability">Visability</a></li>
        <li><a href="#dynamic-instrumentation-kprobes-and-uprobes">Dynamic instrumentation: kprobes and uprobes</a></li>
        <li><a href="#static-instrumentation-tracepoints-and-usdt">Static instrumentation: tracepoints and usdt</a></li>
        <li><a href="#bpftrace"><code>bpftrace</code></a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</nav>


</div>

<script src="/js/URI.js" type="text/javascript"></script>

<script src="/js/page.js" type="text/javascript"></script>
</body>
</html>
