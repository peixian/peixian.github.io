<!DOCTYPE html>
<html><title>docker/containers</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />


<link rel="stylesheet" href="/css/main.min.532078bb650bec3433e8e9db19e0453faa66c9cc0ce761054558a91d87039e9d.css"/>
<script defer src="/en.search.min.f4692ea4d64e41a43748db90f07e640b841e3e86be426a47f6885389450acf3a.js" integrity="sha256-9GkupNZOQaQ3SNuQ8H5kC4QePoa&#43;QmpH9ohTiUUKzzo="></script>

<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<body><header>
    <a href="/" id="logo">
        <img src="/svg/icon.svg" alt="icon" id="raccoon" />

    </a>
    <h3 class="site-title">عجفت الغور</h3>
    <div id="search">
        
<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>

    </div>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
          <h1>docker/containers</h1>

          <p>Tags: <a href="/posts/computers/">computers</a></p>
<h2 id="overview">Overview</h2>
<ul>
<li>Build on <a href="/posts/linux/">linux</a> namespaces and cgroups
<ul>
<li>Namespaces segregate the system by allowing each container to have its own view of the system, via process ID&rsquo;s, network interfaces, etc</li>
<li>Control groups segregate the physical hardware between them</li>
<li>Capabilities splits the privleages of the root user into distinct units that can be managed</li>
<li><code>seccomp</code> filters system calls made by processes to restrict kernel functionality</li>
</ul>
</li>
</ul>
<h2 id="runtimes">Runtimes</h2>
<ul>
<li>LXC - tools, templates, and library and language bindings that use the kernel containment features directly - <a href="https://linuxcontainers.org/">https://linuxcontainers.org/</a></li>
<li><code>libcontainer</code> - <a href="/posts/golang/">golang</a> library created for docker that uses the kernel containment features</li>
<li><code>runc</code> - portable container runtime that implements the OCI spec, cli wrapper for libcontainer</li>
</ul>
<h2 id="high-levels">High Levels</h2>
<ul>
<li>Docker - container engine, used to use LXC but then switched to libcontainer/runc</li>
<li>rkt - podnative design that was built by CoreOS (no longer developed)</li>
<li><code>containerd</code> - daemon that manages the complete container lifecycle, from image transfer to exec to supervision. Used by <a href="/posts/kubernentes/">kubernetes (k8s)</a> and docker internally</li>
<li>CRI-o - lightweight container engine specifically for kube, alternative to running kube</li>
</ul>
<h2 id="debian">Debian</h2>
<ul>
<li><a href="https://knowledgepill.it/posts/docker_install_upgrade/">https://knowledgepill.it/posts/docker_install_upgrade/</a></li>
</ul>
<h2 id="opening-docker-images">Opening Docker Images</h2>
<ul>
<li><a href="https://github.com/P3GLEG/Whaler">https://github.com/P3GLEG/Whaler</a></li>
<li><a href="https://github.com/wagoodman/dive">https://github.com/wagoodman/dive</a></li>
<li><a href="https://www.portainer.io">https://www.portainer.io</a></li>
<li><a href="https://github.com/google/Docker-Explorer">https://github.com/google/Docker-Explorer</a></li>
<li><a href="https://theartofmachinery.com/2021/03/18/reverse_engineering_a_docker_image.html">https://theartofmachinery.com/2021/03/18/reverse_engineering_a_docker_image.html</a></li>
</ul>
<h2 id="tupperware-vs-borg-vs-kube">Tupperware vs Borg vs Kube</h2>
<ul>
<li>
<p>Twine: A Uniﬁed Cluster Management System for Shared Infrastructure</p>
<ul>
<li><a href="https://www.usenix.org/conference/osdi20/presentation/tang">https://www.usenix.org/conference/osdi20/presentation/tang</a></li>
</ul>
</li>
<li>
<p>Regional level (borg is cluster level, but presents a virtual abstract regional level API)</p>
<ul>
<li>Kubernetes only bothers presenting a 4-5k &ldquo;cluster&rdquo; level</li>
<li>Regional level control also introduces significant risk. Rate-limiting destructive operations is a hard learned lesson that people learn many times over. Borg favors external sharding (as in each borg group is on a cluster level), whereas Tupperware shards internally into 20 per region.</li>
</ul>
</li>
<li>
<p>Most interesting part of the paper was that the compute infra is focused on one CPU 64GB ram boxes, with 4 per sled</p>
</li>
<li>
<p>Task control is interesting, borg and kube do this via SIGINT or SIGTERM for preemption. Task control is much more customizable, but leads to potential issues where people are not handling unplanned maintanence. Since the expectation for Borg is that you get 5 minutes to vacate a machine, even unplanned maint events are fine for most applications. Tupperware does not do this, which causes some issues with developer incentives. The hard problem (unplanned maint) should be solved first, since the simpler problem (handling maint) is a reduced form of the hard one</p>
</li>
<li>
<p>Host profiles are interesting, because they allow developers to have fine grained control over their machines. Borg does not offer this, mostly because the foundational teams at Google provide fleet wide improvements (e.g. hugepages). Leaving this up to the user is interesting, but definitely presents problems of stacking since some of these must be enabled on a host level and the cartesian product of configs lead to maintenance headaches.</p>
</li>
<li>
<p>The rebalancer is interesting because it iteratively moves you towards something that fits your usage profile, rather than trying to wait for the solver first. Borg will wait for the solver before actually starting your task, whereas tupperware tries to first start your job <strong>somewhere</strong>, and then move it to an appropriate place.</p>
<ul>
<li>Borg keeps track of what your job historically looks like and incorporates that into the solver, rather than trying to look at it each time</li>
</ul>
</li>
<li>
<p>Entitlement fragementation seems like a huge problem with noisey neighbors and an overloaded abstraction. It&rsquo;s good they&rsquo;re changing it.</p>
</li>
<li>
<p>Evaluation of TCO is a little sketchy? 33% reduction one is from shard manager, 48% one is from offloading, is this a real measurement number?</p>
</li>
<li>
<p>Overall, like rocks, this is another FB project with quite a few knobs, which I think seems good in the moment but does not bode well for the future.</p>
</li>
</ul>
<h2 id="borg-autopilot">Borg Autopilot</h2>
<ul>
<li><a href="https://dl.acm.org/doi/pdf/10.1145/3342195.3387524">https://dl.acm.org/doi/pdf/10.1145/3342195.3387524</a></li>
<li>Verticle and horiztonal autoscaling combination is the most interesting, since most fall into horizontal autoscaling</li>
<li>Difficulty is a programmer problem, vertical autoscaling provides for a good developer experience, since you don&rsquo;t especially need to do anything different or need to rearchitect your thing</li>
<li>Horiztonal demands that you become totally stateless, thus limiting the usage of scaling up particularly high</li>
<li>Borg and other schedulers are then put into a strange domain where</li>
<li>Why not cluster oversubscription?
<ul>
<li>Cluster oversubscription operates on a faster timescale, this needs to reduce into a different timescale</li>
<li>Size limits are required to respond, not to necessarily be oversbuscriped. Prod tasks can also not be oversubscribed</li>
<li>However, better cluster limits means that you have less slack which means that you won&rsquo;t have as much free batch tier</li>
</ul>
</li>
</ul>

          




   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   




      </div>
    </div>
  </div>
</div>

<script src="/js/URI.js" type="text/javascript"></script>

<script src="/js/page.js" type="text/javascript"></script>
</body>
</html>
