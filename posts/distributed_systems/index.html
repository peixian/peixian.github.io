<!DOCTYPE html>
<html><title>distributed systems</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />


<link rel="stylesheet" href="/css/main.min.4b9309a2ca0781957619d4e9500f6539479ebf8cdcbfaac702d6364b30e2c87c.css"/>
<script defer src="/en.search.min.814e6f595e86823d5f3943c2aa00070c05da357d416751942ab1df2937feda0c.js" integrity="sha256-gU5vWV6Ggj1fOUPCqgAHDAXaNX1BZ1GUKrHfKTf&#43;2gw="></script>

<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<body><header>
    <a href="/" id="logo">
        <img src="/svg/icon.svg" alt="icon" id="raccoon" />

    </a>
    <h3 class="site-title">عجفت الغور</h3>
    <div id="search">
        
<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>

    </div>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
          <h1>distributed systems</h1>

          <p>Tags: <a href="/posts/computers/">computers</a></p>
<ul>
<li><a href="http://muratbuffalo.blogspot.com/2021/02/foundational-distributed-systems-papers.html">http://muratbuffalo.blogspot.com/2021/02/foundational-distributed-systems-papers.html</a></li>
<li><a href="https://github.com/stevana/armstrong-distributed-systems/tree/main">https://github.com/stevana/armstrong-distributed-systems/tree/main</a></li>
</ul>
<h2 id="short-introduction">Short Introduction</h2>
<ul>
<li><a href="http://book.mixu.net/distsys/single-page.html">http://book.mixu.net/distsys/single-page.html</a></li>
<li><a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628</a></li>
</ul>
<h2 id="theory">Theory</h2>
<ul>
<li><a href="https://www.the-paper-trail.org/post/2014-08-09-distributed-systems-theory-for-the-distributed-systems-engineer/">https://www.the-paper-trail.org/post/2014-08-09-distributed-systems-theory-for-the-distributed-systems-engineer/</a></li>
</ul>
<h3 id="verification">Verification</h3>
<ul>
<li><a href="https://lawrencecpaulson.github.io/2022/10/12/verifying-distributed-systems-isabelle.html">https://lawrencecpaulson.github.io/2022/10/12/verifying-distributed-systems-isabelle.html</a></li>
</ul>
<h2 id="fallacies">Fallacies</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing">https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing</a></li>
<li><a href="https://www.usenix.org/system/files/conference/hotos15/hotos15-paper-mcsherry.pdf">https://www.usenix.org/system/files/conference/hotos15/hotos15-paper-mcsherry.pdf</a></li>
</ul>
<h2 id="errors-and-examples">Errors and Examples</h2>
<ul>
<li><a href="https://github.com/dranov/protocol-bugs-list">https://github.com/dranov/protocol-bugs-list</a></li>
<li><a href="https://covemountainsoftware.com/2021/03/01/a-survey-of-concurrency-bugs/">https://covemountainsoftware.com/2021/03/01/a-survey-of-concurrency-bugs/</a></li>
</ul>
<h2 id="lamport-writings">Lamport writings</h2>
<ul>
<li><a href="http://lamport.azurewebsites.net/pubs/pubs.html#lamport-paxos">http://lamport.azurewebsites.net/pubs/pubs.html#lamport-paxos</a></li>
</ul>
<h2 id="gfs--google-file-system--storage--dot-dot-dot-dot-dropbox-org-storage-dot-md">GFS (Google File System) - <a href="/posts/storage/">storage</a></h2>
<ul>
<li>Single control plane, master, scared it wouldn&rsquo;t scale but it did</li>
<li>Two specialized operations, record append and snapshot, with other basic file operations
<ul>
<li>record append allows multiple clients to append from small records to a file</li>
<li>snapshot allows the clients to create a copy of a file or a directory tree</li>
</ul>
</li>
<li>batch oriented workloads</li>
<li>commodity servers</li>
<li>Recovery?
<ul>
<li>Checkpoints on metadata state, operation log</li>
<li>shadow managers for recovery to serve read operations only, similar to how RW locks even have contention</li>
</ul>
</li>
<li>Notably, GFS places the consistency checking on the client library, where it requires the you (via the client library) to check</li>
<li>Is <strong>not</strong> linearizable</li>
</ul>
<h3 id="locks">Locks</h3>
<ul>
<li>Read lock aquired on the directory nam (full path to the directory so that it&rsquo;s not being edited or renamed)</li>
<li>Write lock on the file name so that two or more processes cannot write at the same time</li>
<li>Only a small region is locked, since not doing it carefully destroys performance</li>
<li>If a manager dies after locking something, the lock goes with it since it&rsquo;s a central master</li>
<li>left to right locking, so locks are acquired in the shape of
<ul>
<li><code>/a</code>, <code>/a/b</code>, <code>/a/b/c</code> for read locks</li>
<li><code>/a/b/c/file.txt</code> for write locks</li>
</ul>
</li>
</ul>
<h3 id="reading">Reading</h3>
<ol>
<li>To read, user request is first processed by the GFS client that finds a chunk index
<ul>
<li>Since each file is divded into 64MB chunks, the client just %&rsquo;s by 64MB to find the appropriate idx</li>
</ul>
</li>
<li>Then the client requests this information from the manager to get the chunk index and chunk handle, which the manager tells an appropriate replica of</li>
<li>Client then caches the metadata</li>
</ol>
<h3 id="writing">Writing</h3>
<ul>
<li>Two kinds of writes, a <strong>random</strong> write and an <strong>append</strong> (not POSIX compliant)</li>
<li>Replicas hold leases that coordinate the writes</li>
<li>Leases expire, and are only active for a small period of time. This means that if a bad replica has a lease, it will expire and a new node will be found</li>
<li>Primary replicas exist because they allow the data to be consistent</li>
</ul>
<h4 id="writing-workflow">Writing Workflow</h4>
<ul>
<li>Random write and append operations are roughly the same, random writes use an offset for where the data is written, whereas the append just goes to the last chunk</li>
<li>Note that the data is pushed to all the replicas</li>
</ul>
<figure><img src="/ox-hugo/2024-02-18_15-49-47_screenshot.png"/>
</figure>

<ul>
<li>The write (aka commit) happens to the main replica after all the replicas have recieved the data</li>
<li>Replicas then ack whether they&rsquo;ve received the data or not</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Edge Cases on Writing</p>
<ul>
<li>If the last chunk has available space for appending data, then the chunk servers write that data</li>
<li>If the chunk is already full, then the chunkserver asks the client to create a new chunk, which requires a new write and request loop from the manager</li>
<li>If the last chunk is partially full, the chunkserver holding the last chunk will respond to the client with a message about the available server</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Control vs Data Flow</p>
<ul>
<li>GFS, critically, decouples the control and the data. The data physically flows via nearest-in-rack, but the manager still runs things</li>
</ul>
<figure><img src="/ox-hugo/2024-02-18_15-54-54_screenshot.png"/>
    </figure>

</li>
</ul>
<h3 id="deletes">Deletes</h3>
<ul>
<li>Garbage collection is done to avoid sync deletes</li>
<li>Client says a delete needs to happen, so master creates a read lock on the dir and a write lock on the file</li>
<li>Master then revokes the leases in progress, and waits for replicas to finish mutations</li>
<li>Afterwards, delete actually happens</li>
</ul>
<h3 id="consistency-model">Consistency Model</h3>
<h2 id="colossus">Colossus</h2>
<ul>
<li>GFS single master could not hold everything</li>
<li>Reed Solomon vs full replication
<ul>
<li>parity bits are added for error correction, whereas full replication only uses</li>
</ul>
</li>
<li>Frontend has changed
<ul>
<li>Curator -&gt; horizontally scalable metadata servers</li>
<li>Master metadata database</li>
<li>Custodians -&gt; horizontal scalers</li>
</ul>
</li>
<li>GFS was built on the assumption that file sizes were always going to outnumber metadata, but the biggest problem is that that may not be true, small blobs double their size with metadata</li>
</ul>
<h2 id="tectonic">Tectonic</h2>
<ul>
<li>Facebook version of GFS, uses <a href="/posts/k_v_stores/#zippydb">ZippyDB</a> to handle async metadata management and block management</li>
<li><strong>Only allows one single writer at a time</strong> via locking</li>
<li>Each block is 80MB</li>
<li>Organizes the shards in zippy so that all the ones with the same sharding ID go on the same replica, which uses the <code>directory_id</code></li>
<li>Remote chunk store that actually stores the physical bytes</li>
<li>Has a cache note called &ldquo;sealing&rdquo;, which restraints updates, allowing caches to be stored longer</li>
<li>Has a 2pc for rebalancing when nodes need to go down for maintanence</li>
<li>Divides traffic groups into 3, depending on priority</li>
<li>Uses the <a href="/posts/load_balancing/#leaky-bucket-algorithm">Leaky Bucket Algorithm</a></li>
</ul>
<h2 id="bigtable">BigTable</h2>
<ul>
<li>Key features
<ul>
<li>Single row transactions</li>
<li>No batching across row keys</li>
<li>Integer counters</li>
<li>MapReduce jobs as input source and output target</li>
</ul>
</li>
<li>Uses a column family style, with groups of columns and a timestamp within each cell</li>
<li>Treats all data as raw byte strings</li>
<li>All rows have a row key (64kb string), each write and read is atomic</li>
<li>Column families allow for efficient read/write operations, since they usually hold data of the same type (data within a family is physically close)</li>
<li>Also has timestamps, keeps the latest 3 versions</li>
</ul>
<h3 id="sstable--sorted-string-table">SSTable (Sorted String Table)</h3>
<ul>
<li>Components
<ul>
<li>Data File</li>
<li>Primary Index</li>
<li>Bloom filter (for quickly checking if it&rsquo;s in the data structure)</li>
<li>Compression information</li>
<li>Stats</li>
</ul>
</li>
<li>Immutable k/v mappings used to represent tablet states, consisting of blocks, with block indexes facilitating efficient disk access, and can be loaded into memory for quick queries</li>
<li>Memtables are created in memory and flushed to disk as sstables</li>
</ul>

          




   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   
      
   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
      
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   



  <div class="bl-section">
    <h4>Links to this note</h4>
    <div class="backlinks">
        <ul>
       
          <li><a href="/posts/2021_goals/">2021 goals</a></li>
       
          <li><a href="/posts/actor_model/">actor model</a></li>
       
          <li><a href="/posts/broadcasting_and_multi_cast/">broadcasting and multicast</a></li>
       
          <li><a href="/posts/bully_algorithm/">bully algorithm</a></li>
       
          <li><a href="/posts/byzantine_fault_tolerance_bft/">byzantine fault tolerance (BFT)</a></li>
       
          <li><a href="/posts/cap_theorm/">cap theorm (brewer&#39;s conjecture and the feasibility of consistent, available, partition-tolerant web services</a></li>
       
          <li><a href="/posts/20200415152613-cassandra/">Cassandra</a></li>
       
          <li><a href="/posts/clocks_distributed_systems/">clocks (distributed systems)</a></li>
       
          <li><a href="/posts/crdts/">crdts</a></li>
       
          <li><a href="/posts/dataflow/">dataflow</a></li>
       
          <li><a href="/posts/distributed_systems_for_fun_and_profit/">distributed systems for fun and profit</a></li>
       
          <li><a href="/posts/distributed_transactions/">distributed transactions</a></li>
       
          <li><a href="/posts/epaxos/">epaxos</a></li>
       
          <li><a href="/posts/gossip_protocols/">gossip protocols</a></li>
       
          <li><a href="/posts/gray_failures/">gray failures</a></li>
       
          <li><a href="/posts/homogenous_time_blog_post/">Homogenous Time: Ibn Khaldun and Transaction Logs</a></li>
       
          <li><a href="/posts/impossibility_of_consensus_with_one_faulty_process/">impossibility of consensus with one faulty process</a></li>
       
          <li><a href="/posts/kubernentes/">kubernetes (k8s)</a></li>
       
          <li><a href="/posts/load_balancing/">load balancing</a></li>
       
          <li><a href="/posts/metastable_failures_blog_post/">metastable failures blog post</a></li>
       
          <li><a href="/posts/paxos/">paxos</a></li>
       
          <li><a href="/posts/physalia_amazon_ebs/">physalia - amazon ebs</a></li>
       
          <li><a href="/posts/raft/">raft</a></li>
       
          <li><a href="/posts/windows_failover_clusters_hci/">windows failover clusters (hci)</a></li>
       
     </ul>
    </div>
  </div>


      </div>
    </div>
  </div>
</div>

<script src="/js/URI.js" type="text/javascript"></script>

<script src="/js/page.js" type="text/javascript"></script>
</body>
</html>
